---
id: wiki-us-bridgechain
title: 跨链转接桥网络
sidebar_label: 跨链转接桥网络
---

达尔文桥接链是达尔文网络中最重要的部分，也是各个应用子链和公链的桥接枢纽。

达尔文网络自身可以作为一个独立的跨链网络运行，达尔文链将负责共识安全和跨链互操作。同时，得益于 Polkadot 提供了一套开放的平行链接入方式，达尔文链也可以选择接入 Polkadot 作为平行链运行，Polkadot 将接管并负责达尔文链的安全，这样，达尔文网络中的所有应用链将可以通过 Polkadot 连接至外部更广泛的区块链网络。

达尔文的跨链转接桥协议采用的是 CBA(Cryptocurrency-backed Assets) 的模型，底层使用 chain relay 证明交易的存在性以及区块共识。

## I. CBA模型

用户将资产从一条链转移至另一条链，需要将源链上的资产(称之为原生资产)作为抵押物锁仓至跨链桥的属于源链的桥头端，以此为背书，在跨链桥的另一个桥头端目标链上发行相应的资产（称之为映射资产）。

#### CBA 模型的几个要素
- 原生资产 源链上的用户资产, 通常指尚未跨链的资产；
- 映射资产 目标链上发行的以原生资产为抵押物的跨链后的资产；
- Backing 源链端用于抵押、保存和赎回用户原生资产的模块；
- Issuing 目标链端用于发行、销毁用户映射资产的模块；

#### 达尔文转接桥关于CBA模型的使用
在源链和目标链上分别部署 Backing 和 Issuing 模块，Backing 模块接收和锁定用户资产，而 Issuing 模块则以 Backing 上的资产为背书发行与之对应的映射资产。同时任何在 Backing 上的资产的解锁都需要 Issing 模块上的映射资产的销毁证明作为唯一依据。

整个过程需要做到去中心化，没有任何第三方背书，达尔文使用的是 *chain relay* 技术。

## II. chain relay
负责向目标链通过去中心化的方式提交源链上可信的区块以及消息。
- 消息证明: 消息数据存在于区块，消息指纹和区块的 Hash 关联，任何消息的微小修改都会引起区块 Hash 的变化，因此消息的真实性证明依托于对区块的真实性证明；
- 区块证明(共识证明): 对于不同的源链，达尔文选择不同的共识证明方式，一般会使用一种特殊的数据结构，称为 merkle mountain range 来减少需要向目标链同步的数据量。同时会引入一些抵押、奖惩机制来使得同步的共识快速达成以及安全性提升。

chain relay 保证了 Issuing 模块接收来自 Backing 的资产锁定证明的真实可靠，同时反向的 chain relay 保证了 Backing 接收 Issuing 的资产销毁赎回证明的真实性。达尔文桥在 Backing 和 Issuing 模块上加入对方链的一个超轻客户端，底层依赖 chain relay 完成链基本数据之间的同步。之所以我们称之为超轻客户端，是因为相对于轻客户端，其只需要同步非常少的数据，就能够保证对对方数据真实性。这对于节省网络开销和费用是非常有利的。

当前达尔文转接桥对于以太坊到达尔文的 chain relay 完整的采用的上述机制。而达尔文到以太坊的转接桥，考虑到 gas 费用问题，目前块头的正确性使用的是由达尔文到以太坊 Authorities 多签来保证。未来，当以太坊支持 ed25519 的预编译指令后，块头的正确性可以由达尔文 Granpa Authorities 来保证。

桥矿工（relayer）
桥矿工的角色是将一条链上的 relay 证明提交至另一条链，矿工之间互相监督，提交正确的数据可获得奖励，错误的数据可能被惩罚，由于链可能存在分叉场景，因此桥矿工也可能无意间提交错误数据，为避免此类场景，矿工们可以尽可能提交规范链上的被确认的区块。当然这对整个转接桥的安全性没有影响，因为分叉链是不可持续的，一旦当某个矿工发现了这种分叉存在，会立刻发起挑战并纠正过来。

## III. 转接桥注册协议（ERC20）
![架构图](assets/bridger-register.svg)

任何其他网络的资产到达达尔文网络成为映射资产后，其名称保持不变，Symbol 会在之前加一个 m 标识符表示映射级别。精度保持不变。

#### 资产注册
- 用户调用源链端的 Backing 模块接口，发起桥接注册，对于 ERC20 的资产，要求注册的 Token 必须符合 ERC20 标准，同时几个可选参数 name, symbol, decimal 变为必选。
- 注册产生注册消息，桥矿工监听到注册消息之后，将该消息提交至目标链网络的 Issuing 模块。
- 目标链的 Issuing 模块收到该消息后校验并解析消息内容，获取映射资产创建所需信息，对于 ERC20 资产主要包括 Token 的原生地址，name, symbol, decimal 信息。
- Issuing 模块创建映射资产，并产生创建消息证明。
- 该消息被桥矿工同步至源链的 Backing 模块，完成注册流程。

#### 资产跨链
- 用户调用源链 Backing 模块接口，请求跨链转账，完成资产锁定并产生锁定消息证明。
- 同注册流程，桥矿工将该消息证明同步到目标链的 Issuing 模块。
- Issuing 模块验证交易并解析信息，发行映射资产到指定账户。

#### 资产赎回
- 用户调用目标链 Issuing 模块接口，发起赎回请求，Issuing 模块销毁映射资产并产生销毁消息证明。
- 该消息证明同步至源链 Backing 模块。
- Backing 模块验证消息，解锁对应的原生资产至用户指定账户。

#### 手续费
为激励桥矿工的稳定存在而保证桥的稳定工作，会在用户发起注册和转账的过程中收取少量手续费用于支付桥矿工费用。资产注册的时候使用 KTON 作为支付 token，转账使用 RING 作为支付 token，桥在工作的同时将费用一并转移至达尔文网络，由手续费模块以及清算系统统一管理。

#### 开发工具
* 虫洞
前端工具，用于调用链上的交互，用户可以通过该工具完成诸如资产注册，锁仓和赎回的发起操作。
* bridger
桥矿工用于监听和同步链之间的桥相关的消息证明工具。
